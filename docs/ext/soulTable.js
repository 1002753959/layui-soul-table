layui.define(["table","tableFilter","tableChild","tableMerge"],function(exports){var tableFilter=layui.tableFilter,tableChild=layui.tableChild,tableMerge=layui.tableMerge,$=layui.$,table=layui.table,HIDE="layui-hide",isFirst=!0,mod={render:function(e){var t=localStorage.getItem(location.pathname+location.hash+e.id);e.filter&&e.filter.cache&&isFirst&&t?(e.cols=this.deepParse(t),isFirst=!1,table.reload(e.id,e)):(tableFilter.render(e),tableChild.render(e),tableMerge.render(e),(void 0===e.drag||e.drag)&&this.drag(e),this.autoColumnWidth(e))},export:function(e,t){tableFilter.export(e.config||e,t)},autoColumnWidth:function(v){var e=$(v.elem),t=e.next().children(".layui-table-box").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),i=e.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),y=e.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr");String.prototype.width=function(e){var t=e||$("body").css("font"),i=$("<div>"+this+"</div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:t}).appendTo($("body")),a=i.width();return i.remove(),a};t.add(i).on("dblclick",function(e){var i,a,t,l,r,n=$(this),d=n.data("field"),s=n.data("key"),o=n.offset().left,h=e.clientX-o;if(!(1<n.attr("colspan"))&&n.width()-h<=10){var c=n.text().width(n.css("font"))+21,f=n.css("font");y.children('td[data-field="'+d+'"]').each(function(e,t){var i=$(this).text().width(f);c<i&&(c=i)}),c+=32,i=s,a=function(e){e.style.width=c+"px"},t=v.elem.next().find("style")[0],l=t.sheet||t.styleSheet||{},r=l.cssRules||l.rules,layui.each(r,function(e,t){if(t.selectorText===".laytable-cell-"+i)return a(t),!0});for(var p=0;p<v.cols.length;p++)for(var u=0;u<v.cols[p].length;u++)if(v.cols[p][u].field===d){v.cols[p][u].width=c;break}}})},drag:function(C){if(!(1<C.cols.length)){var _=this,e=$(C.elem),E=e.next().children(".layui-table-box"),o=$.merge(E.children(".layui-table-header").children("table"),E.children(".layui-table-fixed").children(".layui-table-header").children("table")),X=E.children(".layui-table-fixed").children(".layui-table-body").children("table"),h=E.children(".layui-table-body").children("table"),N=$.merge(E.children(".layui-table-body").children("table"),X),O=e.next().children(".layui-table-total").children("table"),D=C.id,R="simple"===C.drag||C.drag&&"simple"===C.drag.type,J=C.drag&&C.drag.toolbar,z=!1,U=!1;if(!o.attr("drag")){if(o.attr("drag",!0),J){E.append('<div class="soul-drag-bar"><div data-type="left">左固定</div><div data-type="none">不固定</div><div data-type="right">右固定</div></div>');var P=E.children(".soul-drag-bar");P.children("div").on("mouseenter",function(){$(this).addClass("active")}).on("mouseleave",function(){$(this).removeClass("active")})}o.find("th").each(function(){var k=$(this),F=k.data("field"),S=k.data("key");if(S){var e=S.split("-"),s=C.cols[e[1]][e[2]],I=e[1]+"-"+e[2],w=0<k.parents(".layui-table-fixed").length;$(this).find("span:first,.laytable-cell-checkbox").css("cursor","move").on("mousedown",function(e){if(0===e.button){e.preventDefault();var v=k.clone().css("visibility","hidden"),t=k.position().left,y=k.offset().top,b=e.clientX-t,g=k.parents("tr:eq(0)").css("background-color"),m=k.width(),d=$(this),x=s.fixed;U=!0,$(document).bind("selectstart",function(){return!1}),$("body").on("mousemove",function(e){if(U&&v){E.removeClass("no-left-border"),z||(J&&(P.attr("data-type",x||"none"),P.addClass("active")),k.after(v),k.addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":g,width:m+1}),R||((w?X:N).find('td[data-key="'+S+'"]').each(function(){$(this).after($(this).clone().css("visibility","hidden").attr("data-clone","")),$(this).addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":$(this).css("background-color"),width:m+1})}),!w&&0<O.length&&O.find('td[data-key="'+S+'"]').each(function(){$(this).after($(this).clone().css("visibility","hidden").attr("data-clone","")),$(this).addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":$(this).parents("tr:eq(0)").css("background-color"),width:m+1})}))),z=!0;var t,i,a,l,r,n=e.clientX-b,d=v.prev().prev(),s=0<d.length,o=s?d.data("key").split("-"):[],h=v.next().hasClass("layui-table-patch")?[]:v.next(),c=0<h.length,f=c?h.data("key").split("-"):[],p=s&&v.position().left-n>d.width()/2,u=c&&n-v.position().left>h.width()/2;if(Math.abs(v.position().left-n),0<v.position().left-n?!s||!!x!=!!C.cols[o[1]][o[2]].fixed:!c||!!x!=!!C.cols[f[1]][f[2]].fixed)return k.css("left",v.position().left),N.find('td[data-key="'+S+'"][data-clone]').each(function(e){$(this).prev().css("left",v.position().left)}),0<O.length&&O.find('td[data-key="'+S+'"][data-clone]').each(function(e){$(this).prev().css("left",v.position().left)}),void E.addClass("no-left-border");if(k.css("left",n),p){for(v.after(d),$("#soul-columns"+D+">li[data-value="+F+"]").after($("#soul-columns"+D+">li[data-value="+F+"]").prev()),a=0;a<C.cols.length;a++){for(l=0;l<C.cols[a].length;l++)if(C.cols[a][l].key===I){t=a,i=l;break}if(void 0!==t&&void 0!==i)break}r=C.cols[t][i-1],C.cols[t][i-1]=C.cols[t][i],C.cols[t][i]=r,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))}else if(u){for(v.prev().before(h),$("#soul-columns"+D+">li[data-value="+F+"]").before($("#soul-columns"+D+">li[data-value="+F+"]").next()),a=0;a<C.cols.length;a++){for(l=0;l<C.cols[a].length;l++)if(C.cols[a][l].key===I){t=a,i=l;break}if(void 0!==t&&void 0!==i)break}r=C.cols[t][i+1],C.cols[t][i+1]=C.cols[t][i],C.cols[t][i]=r,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))}N.find('td[data-key="'+S+'"][data-clone]').each(function(){$(this).prev().css("left",n),p?0!==$(this).prev().prev().length&&$(this).after($(this).prev().prev()):u&&0!==$(this).next().length&&$(this).prev().before($(this).next())}),0<O.length&&O.find('td[data-key="'+S+'"][data-clone]').each(function(){$(this).prev().css("left",n),p?0!==$(this).prev().prev().length&&$(this).after($(this).prev().prev()):u&&0!==$(this).next().length&&$(this).prev().before($(this).next())}),e.clientY-y<-15?(0===$("#column-remove").length&&$("body").append('<i id="column-remove" class="layui-red layui-icon layui-icon-delete"></i>'),$("#column-remove").css({top:e.clientY-$("#column-remove").height()/2,left:e.clientX-$("#column-remove").width()/2,"font-size":y-e.clientY+"px"}),$("#column-remove").show()):$("#column-remove").hide()}}).on("mouseup",function(){if($(document).unbind("selectstart"),$("body").off("mousemove").off("mouseup"),U&&v){if(U=!1,z){"checkbox"!==s.type&&d.on("click",function(e){e.stopPropagation()}),z=!1,E.removeClass("no-left-border"),k.removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),k.next().remove();var t=k.prev().data("key");if(x){var e=E.children(".layui-table-header").children("table").find('th[data-key="'+S+'"]');t?e.parent().children('th[data-key="'+t+'"]').after(e):"right"===x?0<k.siblings().length&&E.children(".layui-table-header").children("table").find('th[data-key="'+k.next().data("key")+'"]').prev().after(e):(e.parent().prepend('<th class="layui-hide"></th>'),e.parent().children("th:first").after(e),e.parent().children("th:first").remove())}if(R?(N.find('td[data-key="'+S+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===x){if(0<k.siblings().length){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()}),0<O.length&&O.find('td[data-key="'+S+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===x){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()})):w?(h.find('td[data-key="'+S+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===x){if(0<k.siblings().length){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()}),X.find('td[data-key="'+S+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()}),0<O.length&&O.find('td[data-key="'+S+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===x){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()})):(N.find('td[data-key="'+S+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()}),0<O.length&&O.find('td[data-key="'+S+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()})),v=null,J){if(0<P.children(".active").length&&P.children(".active").attr("data-type")!==P.attr("data-type")){var i,a,l,r,n=P.children(".active").attr("data-type");for(console.log("移动到"+n),i=0;i<C.cols.length;i++)for(a=0;a<C.cols[i].length;a++)"right"===n||"none"===n&&"right"===P.attr("data-type")?void 0===r&&("right"===C.cols[i][a].fixed?r={x:i,y:a}:a===C.cols[i].length-1&&(r={x:i,y:a+1})):void 0!==r||C.cols[i][a].fixed&&"right"!==C.cols[i][a].fixed||(r={x:i,y:a}),C.cols[i][a].key===I&&(l={x:i,y:a});s.fixed="none"!==n&&n,l.y!==r.y&&(C.cols[l.x].splice(l.y,1),l.y<r.y&&(r.y-=1),C.cols[r.x].splice(r.y,0,s),C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))),table.reload(D)}P.removeClass("active")}}else d.unbind("click");$("#column-remove").is(":visible")&&(o.find("thead>tr>th[data-key="+S+"]").addClass(HIDE),N.find('tbody>tr>td[data-key="'+S+'"]').addClass(HIDE),O.find('tbody>tr>td[data-key="'+S+'"]').addClass(HIDE),s.hide=!0,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols)),$("#soul-columns"+D).find('li[data-value="'+F+'"]>input').prop("checked",!1),tableFilter.resize(C)),$("#column-remove").hide()}})}})}})}}},fixTableRemember:function(e,t){e.filter&&e.filter.cache&&(t&&t.rule&&(e.cols[t.rule.selectorText.split("-")[3]][t.rule.selectorText.split("-")[4]].width=t.rule.style.width.replace("px","")),localStorage.setItem(location.pathname+location.hash+e.id,this.deepStringify(e.cols)))},deepStringify:function(e){var i="[[JSON_FUN_PREFIX_",a="_JSON_FUN_SUFFIX]]";return JSON.stringify(e,function(e,t){return"function"==typeof t?i+t.toString()+a:t})},deepParse:function(str){var JSON_SERIALIZE_FIX={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.parse(str,function(key,value){return"string"==typeof value&&0<value.indexOf(JSON_SERIALIZE_FIX.SUFFIX)&&0===value.indexOf(JSON_SERIALIZE_FIX.PREFIX)?eval("("+value.replace(JSON_SERIALIZE_FIX.PREFIX,"").replace(JSON_SERIALIZE_FIX.SUFFIX,"")+")"):value})||{}},clearFilter:function(e){tableFilter.clearFilter(e)},cache:tableFilter.cache};exports("soulTable",mod)});