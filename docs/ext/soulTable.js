layui.define(["table","tableFilter","tableChild","tableMerge"],function(exports){var tableFilter=layui.tableFilter,tableChild=layui.tableChild,tableMerge=layui.tableMerge,$=layui.$,table=layui.table,HIDE="layui-hide",isFirst=!0,mod={render:function(e){var t=localStorage.getItem(location.pathname+location.hash+e.id);e.filter&&e.filter.cache&&isFirst&&t?(e.cols=this.deepParse(t),isFirst=!1,table.reload(e.id,e)):(tableFilter.render(e),tableChild.render(e),tableMerge.render(e),this.fixTotal(e),(void 0===e.drag||e.drag)&&this.drag(e),e.rowDrag&&this.rowDrag(e),this.autoColumnWidth(e),this.contextmenu(e))},export:function(e,t){tableFilter.export(e.config||e,t)},autoColumnWidth:function(b){var e=$(b.elem),t=e.next().children(".layui-table-box").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),i=e.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-header").children("table").children("thead").children("tr").children("th"),y=e.next().children(".layui-table-box").children(".layui-table-body").children("table").children("tbody").children("tr");String.prototype.width=function(e){var t=e||$("body").css("font"),i=$("<div>"+this+"</div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:t}).appendTo($("body")),l=i.width();return i.remove(),l};t.add(i).on("dblclick",function(e){var i,l,t,a,n,r=$(this),o=r.data("field"),d=r.data("key"),s=r.offset().left,c=e.clientX-s;if(!(1<r.attr("colspan"))&&r.width()-c<=10){var h=r.text().width(r.css("font"))+21,f=r.css("font");y.children('td[data-field="'+o+'"]').each(function(e,t){var i=$(this).text().width(f);h<i&&(h=i)}),h+=32,i=d,l=function(e){e.style.width=h+"px"},t=b.elem.next().find("style")[0],a=t.sheet||t.styleSheet||{},n=a.cssRules||a.rules,layui.each(n,function(e,t){if(t.selectorText===".laytable-cell-"+i)return l(t),!0});for(var u=0;u<b.cols.length;u++)for(var p=0;p<b.cols[u].length;p++)if(b.cols[u][p].field===o){b.cols[u][p].width=h;break}}})},drag:function(C){if(!(1<C.cols.length)){var _=this,e=$(C.elem),X=e.next().children(".layui-table-box"),s=$.merge(X.children(".layui-table-header").children("table"),X.children(".layui-table-fixed").children(".layui-table-header").children("table")),E=X.children(".layui-table-fixed").children(".layui-table-body").children("table"),c=X.children(".layui-table-body").children("table"),D=$.merge(X.children(".layui-table-body").children("table"),E),z=e.next().children(".layui-table-total").children("table"),N=e.next().children(".layui-table-total").children("table.layui-table-total-fixed"),h=e.next().children(".layui-table-total").children("table:eq(0)"),R=C.id,O="simple"===C.drag||C.drag&&"simple"===C.drag.type,J=C.drag&&C.drag.toolbar,T=!1,P=!1;if(!s.attr("drag")){if(s.attr("drag",!0),J){X.append('<div class="soul-drag-bar"><div data-type="left">左固定</div><div data-type="none">不固定</div><div data-type="right">右固定</div></div>');var q=X.children(".soul-drag-bar");q.children("div").on("mouseenter",function(){$(this).addClass("active")}).on("mouseleave",function(){$(this).removeClass("active")})}s.find("th").each(function(){var k=$(this),w=k.data("field"),I=k.data("key");if(I){var e=I.split("-"),d=C.cols[e[1]][e[2]],S=e[1]+"-"+e[2],F=0<k.parents(".layui-table-fixed").length;$(this).find("span:first,.laytable-cell-checkbox").css("cursor","move").on("mousedown",function(e){if(0===e.button){e.preventDefault();var b=k.clone().css("visibility","hidden"),t=k.position().left,y=k.offset().top,v=e.clientX-t,x=k.parents("tr:eq(0)").css("background-color"),g=k.width(),o=$(this),m=d.fixed;P=!0,$(document).bind("selectstart",function(){return!1}),$("body").on("mousemove",function(e){if(P&&b){X.removeClass("no-left-border"),T||(J&&(q.attr("data-type",m||"none"),q.addClass("active")),k.after(b),k.addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":x,width:g+1}),O||((F?E:D).find('td[data-key="'+I+'"]').each(function(){$(this).after($(this).clone().css("visibility","hidden").attr("data-clone","")),$(this).addClass("isDrag").css({position:"absolute","z-index":1,"border-left":"1px solid #e6e6e6","background-color":$(this).css("background-color"),width:g+1})}),0<z.length&&(F?N:z).find('td[data-key="'+I+'"]').each(function(){$(this).after($(this).clone().css("visibility","hidden").attr("data-clone","")),$(this).addClass("isDrag").css({position:"absolute","z-index":1,"background-color":$(this).parents("tr:eq(0)").css("background-color"),width:g+1})}))),T=!0;var t,i,l,a,n,r=e.clientX-v,o=b.prev().prev(),d=0<o.length,s=d?o.data("key").split("-"):[],c=b.next().hasClass("layui-table-patch")?[]:b.next(),h=0<c.length,f=h?c.data("key").split("-"):[],u=d&&b.position().left-r>o.width()/2,p=h&&r-b.position().left>c.width()/2;if(Math.abs(b.position().left-r),0<b.position().left-r?!d||!!m!=!!C.cols[s[1]][s[2]].fixed:!h||!!m!=!!C.cols[f[1]][f[2]].fixed)return k.css("left",b.position().left),D.find('td[data-key="'+I+'"][data-clone]').each(function(e){$(this).prev().css("left",b.position().left)}),0<z.length&&z.find('td[data-key="'+I+'"][data-clone]').each(function(e){$(this).prev().css("left",b.position().left)}),void X.addClass("no-left-border");if(k.css("left",r),u){for(b.after(o),$("#soul-columns"+R+">li[data-value="+w+"]").after($("#soul-columns"+R+">li[data-value="+w+"]").prev()),l=0;l<C.cols.length;l++){for(a=0;a<C.cols[l].length;a++)if(C.cols[l][a].key===S){t=l,i=a;break}if(void 0!==t&&void 0!==i)break}n=C.cols[t][i-1],C.cols[t][i-1]=C.cols[t][i],C.cols[t][i]=n,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))}else if(p){for(b.prev().before(c),$("#soul-columns"+R+">li[data-value="+w+"]").before($("#soul-columns"+R+">li[data-value="+w+"]").next()),l=0;l<C.cols.length;l++){for(a=0;a<C.cols[l].length;a++)if(C.cols[l][a].key===S){t=l,i=a;break}if(void 0!==t&&void 0!==i)break}n=C.cols[t][i+1],C.cols[t][i+1]=C.cols[t][i],C.cols[t][i]=n,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))}D.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().css("left",r),u?0!==$(this).prev().prev().length&&$(this).after($(this).prev().prev()):p&&0!==$(this).next().length&&$(this).prev().before($(this).next())}),0<z.length&&z.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().css("left",r),u?0!==$(this).prev().prev().length&&$(this).after($(this).prev().prev()):p&&0!==$(this).next().length&&$(this).prev().before($(this).next())}),e.clientY-y<-15?(0===$("#column-remove").length&&$("body").append('<i id="column-remove" class="layui-red layui-icon layui-icon-delete"></i>'),$("#column-remove").css({top:e.clientY-$("#column-remove").height()/2,left:e.clientX-$("#column-remove").width()/2,"font-size":y-e.clientY+"px"}),$("#column-remove").show()):$("#column-remove").hide()}}).on("mouseup",function(){if($(document).unbind("selectstart"),$("body").off("mousemove").off("mouseup"),P&&b){if(P=!1,T){"checkbox"!==d.type&&o.on("click",function(e){e.stopPropagation()}),T=!1,X.removeClass("no-left-border"),k.removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),k.next().remove();var t=k.prev().data("key");if(m){var e=X.children(".layui-table-header").children("table").find('th[data-key="'+I+'"]');t?e.parent().children('th[data-key="'+t+'"]').after(e):"right"===m?0<k.siblings().length&&X.children(".layui-table-header").children("table").find('th[data-key="'+k.next().data("key")+'"]').prev().after(e):(e.parent().prepend('<th class="layui-hide"></th>'),e.parent().children("th:first").after(e),e.parent().children("th:first").remove())}if(O?(D.find('td[data-key="'+I+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===m){if(0<k.siblings().length){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()}),0<z.length&&z.find('td[data-key="'+I+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===m){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()})):F?(c.find('td[data-key="'+I+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===m){if(0<k.siblings().length){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()}),E.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit","border-left":"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()}),0<z.length&&(h.find('td[data-key="'+I+'"]').each(function(){if(t)$(this).parent().children('td[data-key="'+t+'"]').after($(this));else if("right"===m){var e=$(this).parent().children('td[data-key="'+k.next().data("key")+'"]').prev();0<e.length?e.after($(this)):($(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove())}else $(this).parent().prepend('<td class="layui-hide"></td>'),$(this).parent().children("td:first").after($(this)),$(this).parent().children("td:first").remove()}),N.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()}))):(D.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()}),0<z.length&&z.find('td[data-key="'+I+'"][data-clone]').each(function(){$(this).prev().removeClass("isDrag").css({position:"relative","z-index":"inherit",left:"inherit",width:"inherit","background-color":"inherit"}),$(this).remove()})),b=null,J){if(0<q.children(".active").length&&q.children(".active").attr("data-type")!==q.attr("data-type")){var i,l,a,n,r=q.children(".active").attr("data-type");for(i=0;i<C.cols.length;i++)for(l=0;l<C.cols[i].length;l++)"right"===r||"none"===r&&"right"===q.attr("data-type")?void 0===n&&("right"===C.cols[i][l].fixed?n={x:i,y:l}:l===C.cols[i].length-1&&(n={x:i,y:l+1})):void 0!==n||C.cols[i][l].fixed&&"right"!==C.cols[i][l].fixed||(n={x:i,y:l}),C.cols[i][l].key===S&&(a={x:i,y:l});d.fixed="none"!==r&&r,a.y!==n.y&&(C.cols[a.x].splice(a.y,1),a.y<n.y&&(n.y-=1),C.cols[n.x].splice(n.y,0,d),C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols))),table.reload(R)}q.removeClass("active")}}else o.unbind("click");$("#column-remove").is(":visible")&&(s.find("thead>tr>th[data-key="+I+"]").addClass(HIDE),D.find('tbody>tr>td[data-key="'+I+'"]').addClass(HIDE),z.find('tbody>tr>td[data-key="'+I+'"]').addClass(HIDE),d.hide=!0,C.filter&&C.filter.cache&&localStorage.setItem(location.pathname+location.hash+C.id,_.deepStringify(C.cols)),$("#soul-columns"+R).find('li[data-value="'+w+'"]>input').prop("checked",!1),tableFilter.resize(C)),$("#column-remove").hide()}})}})}})}}},rowDrag:function(s){var y=$(s.elem),e=y.next().children(".layui-table-box"),i=e.children(".layui-table-fixed").children(".layui-table-body").children("table"),l=e.children(".layui-table-body").children("table"),t=$.merge(e.children(".layui-table-body").children("table"),i),c=s.id,v=!1,a=s.rowDrag.trigger||"row",n="row"===a?t.children("tbody").children("tr"):t.find(a);"row"!==a&&t.find(a).css("cursor","move"),n.on("mousedown",function(e){if(0===e.button){var o="row"===a?$(this):$(this).parents("tr:eq(0)"),d=parseInt(o.data("index")),f=l.children("tbody").children("tr[data-index="+d+"]"),u=f.clone().css("visibility","hidden"),p=i.children("tbody").children("tr[data-index="+d+"]"),t=o.position().top,b=e.clientY-t;$("body").on("mousemove",function(e){if(!v){v=!0;var t=y.next().find("style")[0],i=t.sheet||t.styleSheet||{};i.insertRule(".layui-table-view .layui-table td{cursor: move;}"),i.insertRule(".layui-table tr{transition: none}"),f.after(u),f.css({position:"absolute","z-index":1}),p.each(function(){$(this).after($(this).clone().css("visibility","hidden")),$(this).css({position:"absolute","z-index":102})})}var l=e.clientY-b,a=u.position().top,n=f.prev(),r=0<n.length,o=u.next(),d=0<o.length,s=r&&a-l>n.height()/2,c=d&&l-a>o.height()/2;if(0<a-l?!r:!d)return f.css("top",a),void p.each(function(){$(this).css("top",a)});function h(e,t){var i=parseInt(e.data("index"))+t;return e.data("index",i),e.attr("data-index",i),e}f.css("top",l),p.each(function(){$(this).css("top",l)}),s?(h(f,-1),u.after(h(n,1)),p.each(function(){h($(this),-1),$(this).next().after(h($(this).prev(),1))})):c&&(h(f,1).before(h(o,-1)),p.each(function(){h($(this),1),$(this).before(h($(this).next().next(),-1))}))}).on("mouseup",function(e){if($("body").off("mousemove").off("mouseup"),v){v=!1,f.css({position:"initial","z-index":"inherit"}),f.next().remove(),p.each(function(){$(this).css({position:"initial","z-index":"inherit"}),$(this).next().remove()});var t=y.next().find("style")[0],i=t.sheet||t.styleSheet||{},l=i.cssRules||i.rules;layui.each(l,function(e,t){".layui-table-view .layui-table td"===t.selectorText&&(t.style.cursor="default")});var a=o.index();if(a!==d&&"function"==typeof s.rowDrag.done){var n=layui.table.cache[c],r=n.splice(d,1)[0];n.splice(a,0,r),s.rowDrag.done.call(s,{row:r,newIndex:a,oldIndex:d,cache:n})}}})}})},fixTableRemember:function(e,t){e.filter&&e.filter.cache&&(t&&t.rule&&(e.cols[t.rule.selectorText.split("-")[3]][t.rule.selectorText.split("-")[4]].width=t.rule.style.width.replace("px","")),localStorage.setItem(location.pathname+location.hash+e.id,this.deepStringify(e.cols)))},contextmenu:function(h){for(var e=$(h.elem),t=e.next().children(".layui-table-box"),i=$.merge(t.children(".layui-table-header").children("table"),t.children(".layui-table-fixed").children(".layui-table-header").children("table")),l=t.children(".layui-table-fixed").children(".layui-table-body").children("table"),a=$.merge(t.children(".layui-table-body").children("table"),l),n=e.next().children(".layui-table-total").children("table"),f=h.id,r={header:{box:i,tag:"th",opts:h.contextmenu?h.contextmenu.header:"",cols:{}},body:{box:a,tag:"td",opts:h.contextmenu?h.contextmenu.body:"",cols:{},isBody:!0},total:{box:n,tag:"td",opts:h.contextmenu?h.contextmenu.total:"",cols:{}}},o=!1,d=0;d<h.cols.length;d++)for(var s=0;s<h.cols[d].length;s++)h.cols[d][s].contextmenu&&(o=!0,r.header.cols[h.cols[d][s].key]=h.cols[d][s].contextmenu.header,r.body.cols[h.cols[d][s].key]=h.cols[d][s].contextmenu.body,r.total.cols[h.cols[d][s].key]=h.cols[d][s].contextmenu.total);if(h.contextmenu||o){for(var c in r)!function(i){r[i].box.find(r[i].tag).on("contextmenu",function(e){$("#soul-table-contextmenu-wrapper").remove(),$("body").append('<div id="soul-table-contextmenu-wrapper"></div>'),$("#soul-table-contextmenu-wrapper").on("click",function(e){e.stopPropagation()});var t=r[i].cols[$(this).data("key").substr($(this).data("key").indexOf("-")+1)];return!1!==t&&(t&&0<t.length?(u($("#soul-table-contextmenu-wrapper"),e.clientX,e.clientY,t,$(this),r[i].box,r[i].tag,r[i].isBody),!1):!1!==r[i].opts&&(r[i].opts&&0<r[i].opts.length?(u($("#soul-table-contextmenu-wrapper"),e.clientX,e.clientY,r[i].opts,$(this),r[i].box,r[i].tag,r[i].isBody),!1):void 0))})}(c);$("body").on("click",function(){$("#soul-table-contextmenu-wrapper").remove()})}function u(e,t,i,l,r,o,d,s){var a,n=[],c=[];for(c.push("top: "+i+"px;"),c.push("left: "+t+"px;"),n.push('<ul style="'+c.join("")+'" class="soul-table-contextmenu">'),a=0;a<l.length;a++)n.push('<li data-index="'+a+'" class="'+(l[a].children&&0<l[a].children.length?"contextmenu-children":"")+'">'),l[a].icon?n.push('<i class="prefixIcon '+l[a].icon+'" />'):n.push('<i class="prefixIcon" />'),n.push(l[a].name),l[a].children&&0<l[a].children.length&&n.push('<i class="endIcon layui-icon layui-icon-right" />'),n.push("</li>");for(n.push("</ul>"),e.append(n.join("")),a=0;a<l.length;a++)"function"==typeof l[a].click&&function(t){e.children(".soul-table-contextmenu:last").children('li[data-index="'+t+'"]').on("click",function(){var e=r.parents("tr:eq(0)").data("index"),a=o.find('tr[data-index="'+e+'"]'),n=layui.table.cache[f][e];l[t].click.call(h,{cell:r,elem:"th"===d?r:s?o.children("tbody").children('tr[data-index="'+e+'"]').children('[data-key="'+r.data("key")+'"]'):o.find('[data-key="'+r.data("key")+'"]'),trElem:o.children("tbody").children('tr[data-index="'+e+'"]'),text:r.text(),field:r.data("field"),del:s?function(){table.cache[f][e]=[],a.remove(),table.resize(f)}:"",update:s?function(e){e=e||{},layui.each(e,function(i,e){if(i in n){var l,t=a.children('td[data-field="'+i+'"]');n[i]=e,table.eachCols(f,function(e,t){t.field==i&&t.templet&&(l=t.templet)}),t.children(".layui-table-cell").html(l?"function"==typeof l?l(n):layui.laytpl($(l).html()||e).render(n):e),t.data("content",e)}})}:"",row:s?n:{}}),$("#soul-table-contextmenu-wrapper").remove()})}(a);e.children(".soul-table-contextmenu:last").children("li").on("mouseenter",function(e){e.stopPropagation(),$(this).siblings(".contextmenu-children").children("ul").remove(),$(this).hasClass("contextmenu-children")&&u($(this),$(this).outerWidth(),$(this).position().top,l[$(this).data("index")].children,r,o,d,s)})}},fixTotal:function(e){var t=$(e.elem),i=t.next().children(".layui-table-total");if(0<i.length){var l=t.next().children(".layui-table-box"),a=l.children(".layui-table-fixed-l").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),n=l.children(".layui-table-fixed-r").children(".layui-table-body").children("table").children("tbody").children("tr:eq(0)").children("td"),r=[];0<a.length&&(t.next().find("style").append(".layui-table-total-fixed-l .layui-table-patch{display: none}"),t.next().css("position","relative"),r.push('<table style="position: absolute;background-color: #fff;left: 0;top: '+(i.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-l"><tbody><tr>'),a.each(function(){$(this).data("key")&&r.push(i.children("table:eq(0)").find('[data-key="'+$(this).data("key")+'"]').prop("outerHTML"))}),r.push("</tr></tbody></table>"),i.append(r.join(""))),0<n.length&&(t.next().find("style").append(".layui-table-total-fixed-r td:first-child{border-left:1px solid #e6e6e6}.layui-table-total-fixed-r td:last-child{border-left: none}"),t.next().css("position","relative"),(r=[]).push('<table style="position: absolute;background-color: #fff;right: 0;top: '+(i.position().top+1)+'px" cellspacing="0" cellpadding="0" border="0" class="layui-table layui-table-total-fixed layui-table-total-fixed-r"><tbody><tr>'),n.each(function(){r.push(i.children("table:eq(0)").find('[data-key="'+$(this).data("key")+'"]').prop("outerHTML"))}),r.push("</tr></tbody></table>"),i.append(r.join("")))}},deepStringify:function(e){var i="[[JSON_FUN_PREFIX_",l="_JSON_FUN_SUFFIX]]";return JSON.stringify(e,function(e,t){return"function"==typeof t?i+t.toString()+l:t})},deepParse:function(str){var JSON_SERIALIZE_FIX={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"};return JSON.parse(str,function(key,value){return"string"==typeof value&&0<value.indexOf(JSON_SERIALIZE_FIX.SUFFIX)&&0===value.indexOf(JSON_SERIALIZE_FIX.PREFIX)?eval("("+value.replace(JSON_SERIALIZE_FIX.PREFIX,"").replace(JSON_SERIALIZE_FIX.SUFFIX,"")+")"):value})||{}},clearFilter:function(e){tableFilter.clearFilter(e)},cache:tableFilter.cache};exports("soulTable",mod)});