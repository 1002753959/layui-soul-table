layui.define(["table","element","form"],function(exports){var $=layui.jquery,table=layui.table,tableChildren={},ELEM_HOVER="soul-table-hover",mod={render:function(r){var t,d=this,i=$(r.elem),o=r.id,c=i.next().children(".layui-table-box").children(".layui-table-header").children("table"),h=i.next().children(".layui-table-box").children(".layui-table-body").children("table"),n=i.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").children("table"),l=d.getCompleteCols(r.cols),s=[],u=void 0===r.soulSort||r.soulSort;for(d.fixHoverStyle(r),t=0;t<l.length;t++)l[t].children&&0<l[t].children.length&&s.push(t);if(void 0===i.attr("lay-filter")&&i.attr("lay-filter",o),tableChildren[o]||("function"==typeof r.rowEvent&&table.on("row("+i.attr("lay-filter")+")",function(e){var t=$(this).data("index");e.tr=$.merge(n.children("tbody").children('tr[data-index="'+t+'"]'),h.children("tbody").children('tr[data-index="'+t+'"]')),r.rowEvent(e)}),"function"==typeof r.rowDoubleEvent&&table.on("rowDouble("+i.attr("lay-filter")+")",function(e){var t=$(this).data("index");e.tr=$.merge(n.children("tbody").children('tr[data-index="'+t+'"]'),h.children("tbody").children('tr[data-index="'+t+'"]')),r.rowDoubleEvent(e)})),0<s.length)for(t=0;t<s.length;t++)!function(){var a=l[s[t]],e=s[t];!u||r.url&&r.page||table.on("sort("+i.attr("lay-filter")+")",function(){d.render(r)}),a.isChild&&"function"==typeof a.isChild?h.find("tr").find('td[data-key$="'+a.key+'"]>div').each(function(e){a.isChild(layui.table.cache[o][e])&&$(this).addClass("childTable").css({cursor:"pointer"}).html('<i style="font-weight: bolder" class="layui-icon layui-icon-right"></i>')}):h.find("tr").find('td[data-key$="'+a.key+'"]>div').addClass("childTable").css({cursor:"pointer"}).html('<i style="font-weight: bolder" class="layui-icon layui-icon-right"></i>'),h.children("tbody").children("tr").each(function(){$(this).children("td:eq("+e+")").children(".childTable").on("click",function(){var e=table.cache[r.id][$(this).parents("tr:eq(0)").data("index")],t=a.children;if("function"==typeof a.children&&(t=a.children(e)),2===a.show)layer.open({type:1,title:"子表",maxmin:!0,content:d.getTables(this,e,a,r,t),area:"1000px",offset:"100px"}),d.renderTable(this,e,a,o,t);else{!$(this).find("i").hasClass("layui-icon-down")&&a.collapse&&h.children("tbody").children("tr").children("td").children(".childTable").each(function(){$(this).find("i").hasClass("layui-icon-down")&&($(this).find("i").toggleClass("layui-icon-down"),d.destroyChildren($(this),o))}),$(this).find("i").hasClass("layui-icon-down")||$(this).parents("tr:eq(0)").children("td").children(".childTable").each(function(){$(this).find("i").hasClass("layui-icon-down")&&($(this).find("i").toggleClass("layui-icon-down"),d.destroyChildren($(this),o))}),$(this).find("i").toggleClass("layui-icon-down");var i=$(this).parents("td:eq(0)").attr("rowspan");if($(this).find("i").hasClass("layui-icon-down")){var n=[];if(n.push('<tr class="noHover childTr"><td colspan="'+c.find("th:visible").length+'" style="cursor: inherit; padding: 0; width: '+$(this).parents("tr:eq(0)").width()+'px">'),n.push(d.getTables(this,e,a,r,t)),n.push("</td></tr>"),i){var l=parseInt($(this).parents("tr:eq(0)").data("index"))+parseInt(i)-1;$(this).parents("table:eq(0)").children().children("[data-index='"+l+"']").after(n.join(""))}else $(this).parents("tr:eq(0)").after(n.join(""));d.renderTable(this,e,a,o,t),$(this).parents("tr:eq(0)").next().children("td").children(".layui-tab").children(".layui-tab-content").on("click",function(e){e.stopPropagation()}).off("dblclick").on("dblclick",function(e){e.stopPropagation()})}else d.destroyChildren($(this),o)}})}),a.spread&&2!==a.show&&h.children("tbody").children("tr").children("td").children(".childTable").trigger("click")}()},getTables:function(e,t,i,n,l){var a,r=[],d=$(n.elem),o=n.id+$(e).parents("tr:eq(0)").data("index"),c=d.next().children(".layui-table-box").children(".layui-table-body").children("table");if(r.push('<div class="layui-tab layui-tab-card" lay-filter="table-child-'+o+'" style="margin: 0;border: 0;">'),void 0===i.childTitle||i.childTitle){for(r.push('<ul class="layui-tab-title">'),a=0;a<l.length;a++)r.push('<li class="'+(0===a?"layui-this":"")+'">'+("function"==typeof l[a].title?l[a].title(t):l[a].title)+"</li>");r.push("</ul>")}for(r.push('<div class="layui-tab-content" style="padding-bottom: 10px;max-width: '+(c.width()-2)+'px">'),a=0;a<l.length;a++){var h=o+a;r.push('<div class="layui-tab-item layui-show"><form action="" class="layui-form" ><table id="'+h+'" lay-filter="'+h+'"></table></form></div>')}return r.push("</div></div>"),r.join("")},renderTable:function(i,n,l,a,r){var e=[],d=this,o=a+$(i).parents("tr:eq(0)").data("index");if(l.lazy)e.push(h(d,i,n,l,a,0,r));else for(var c=0;c<r.length;c++)e.push(h(d,i,n,l,a,c,r));function h(e,t,i,n,l,a,r){var d,o=e.deepClone(r[a]),c=l+$(t).parents("tr:eq(0)").data("index")+a;return o.id=c,o.elem="#"+c,"function"==typeof o.where&&(o.where=o.where(i)),"function"==typeof o.data&&(o.data=o.data(i)),"function"==typeof o.url&&(o.url=o.url(i)),d=table.render(o),n.lazy||0===a||$("#"+c).parents(".layui-tab-item:eq(0)").removeClass("layui-show"),"function"==typeof o.checkboxEvent&&table.on("checkbox("+c+")",function(e){o.checkboxEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),"function"==typeof o.editEvent&&table.on("edit("+c+")",function(e){o.editEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),"function"==typeof o.toolEvent&&table.on("tool("+c+")",function(e){o.toolEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),"function"==typeof o.toolbarEvent&&table.on("toolbar("+c+")",function(e){o.toolbarEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),"function"==typeof o.rowEvent&&table.on("row("+c+")",function(e){o.rowEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),"function"==typeof o.rowDoubleEvent&&table.on("rowDouble("+c+")",function(e){o.rowDoubleEvent(e,table.cache[l][$(t).parents("tr:eq(0)").data("index")])}),d}tableChildren[o]=e,l.lazy&&layui.element.on("tab(table-child-"+o+")",function(e){var t=!1;for(c=0;c<tableChildren[o].length;c++)if(tableChildren[o][c].config.id===o+e.index){t=!0;break}t||tableChildren[o].push(h(d,i,n,l,a,e.index,r))})},destroyChildren:function(e,t){var i=e.parents("td:eq(0)").attr("rowspan");if(i){var n=e.parents("tr:eq(0)").index()+parseInt(i);e.parents("table:eq(0)").children().children("tr:eq("+n+")").remove()}else e.parents("tr:eq(0)").next().remove();var l=tableChildren[t+e.parents("tr:eq(0)").data("index")];layui.tableFilter&&layui.tableFilter.destroy(l),delete tableChildren[t+e.parents("tr:eq(0)").data("index")]},cloneJSON:function(obj){var JSON_SERIALIZE_FIX={PREFIX:"[[JSON_FUN_PREFIX_",SUFFIX:"_JSON_FUN_SUFFIX]]"},sobj=JSON.stringify(obj,function(e,t){return"function"==typeof t?JSON_SERIALIZE_FIX.PREFIX+t.toString()+JSON_SERIALIZE_FIX.SUFFIX:t});return JSON.parse(sobj,function(key,value){return"string"==typeof value&&0<value.indexOf(JSON_SERIALIZE_FIX.SUFFIX)&&0===value.indexOf(JSON_SERIALIZE_FIX.PREFIX)?eval("("+value.replace(JSON_SERIALIZE_FIX.PREFIX,"").replace(JSON_SERIALIZE_FIX.SUFFIX,"")+")"):value})||{}},fixHoverStyle:function(e){var t=$(e.elem),i=t.next().children(".layui-table-box").children(".layui-table-body").children("table"),n=t.next().children(".layui-table-box").children(".layui-table-fixed").children(".layui-table-body").children("table"),l=t.next().find("style")[0],a=l.sheet||l.styleSheet||{};this.addCSSRule(a,".layui-table-hover","background-color: inherit"),this.addCSSRule(a,".layui-table-hover.soul-table-hover","background-color: #F2F2F2"),$.merge(n.children("tbody").children("tr"),i.children("tbody").children("tr")).on("mouseenter",function(){var e=$(this),t=$(this).data("index");e.data("off")||(n.children("tbody").children("tr[data-index="+t+"]").addClass(ELEM_HOVER),i.children("tbody").children("tr[data-index="+t+"]").addClass(ELEM_HOVER))}).on("mouseleave",function(){var e=$(this),t=$(this).data("index");e.data("off")||(n.children("tbody").children("tr[data-index="+t+"]").removeClass(ELEM_HOVER),i.children("tbody").children("tr[data-index="+t+"]").removeClass(ELEM_HOVER))})},addCSSRule:function(e,t,i,n){"inserRule"in e?e.insertRule(t+"{"+i+"}",n):"addRule"in e&&e.addRule(t,i,n)},deepClone:function(e){var t=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e&&"object"==typeof e[i]?this.deepClone(e[i]):e[i]);return t},getCompleteCols:function(e){var t,i,n,l,a=this.deepClone(e);for(t=0;t<a.length;t++)for(i=0;i<a[t].length;i++)if(!a[t][i].exportHandled){if(1<a[t][i].rowspan)for((l=this.deepClone(a[t][i])).exportHandled=!0,n=t+1;n<a.length;)a[n].splice(i,0,l),n++;if(1<a[t][i].colspan){for((l=this.deepClone(a[t][i])).exportHandled=!0,n=1;n<a[t][i].colspan;n++)a[t].splice(i,0,l);i=i+a[t][i].colspan-1}}return a[a.length-1]}};exports("tableChild",mod)});